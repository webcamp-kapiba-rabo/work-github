<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h2 class="marker">ショッピングカート</h2>
          <% if @cart_products.present? %>
          <div class="cart1">
            <%= link_to "カートを空にする", cart_products_path, method: :delete, class:"btn btn-outline-danger btn-cart_product_all_destroy" %>
          </div>

          <table class="cart" border="2">
            <thead>
              <tr bgcolor="lightgray">
                <th>商品名</th>
                <th>単価(税込)</th>
                <th>数量</th>
                <th>小計</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
            <% @cart_products.each do |cart_product| %>
              <tr>
                <td>
                  <%= attachment_image_tag( cart_product.product, :image, size: "55x40", fallback: "cake.jpg") %>
                  <%= cart_product.product.name %>
                </td>
                <td>
                  <%= (cart_product.product.excluding_tax_price * 1.1).floor %>円
                </td>
                <td>
                  <%= form_with model:cart_product, url: cart_product_path(cart_product), method: :patch , local: true do |f| %>
                    <%= f.select :amount, [ '1', '2', '3', '4', '5', '6', '7', '8', '9'],  class: 'amount' %>
                    <%= f.submit "変更", class: "btn btn-success" %>
                  <% end %>
                </td>
                <td>
                  <%= (cart_product.amount.to_i * cart_product.product.excluding_tax_price.to_i * 1.1).floor %>円
                </td>
                <td>
                  <%= link_to " 削除する", cart_product_path(cart_product), method: :delete, class:"btn btn-danger btn-cart_product_destroy" %>
                </td>
              </tr>
            <% end %>
            </tbody>
          </table>

          <p>
            <%= link_to " 買い物を続ける", root_path, class:"btn btn-primary btn-root" %>
            <table class="cart2" border="2">
              <td bgcolor="lightgray">合計金額</td>
              <td><%= total_price(@cart_products) %>円</td>
            </table>
          </p>

          <div class="cart3">
            <%= link_to " 情報入力に進む", new_order_path, class:"btn btn-success btn-order_new" %>
          </div>

          <% else %>
            <p>ショッピングカートに商品がありません。</p>
            <p><%= link_to "商品一覧", products_path, class: "btn-primary" %></p>

          <% end %>


    </div>
  </div>
</div>